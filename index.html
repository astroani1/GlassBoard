<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jira Clone - Liquid Glass</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Chart.js and data labels plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>

    <style>
        /* --- Liquid Glass Theme Setup --- */
        :root {
            --bg-color: #4158D0;
            --bg-image: linear-gradient(43deg, #4158D0 0%, #C850C0 46%, #FFCC70 100%);
            --text-color: #1e293b;
            /* Slate text tokens for consistent mapping */
            --text-800: #0f172a;
            --text-700: #1e293b;
            --text-600: #334155;
            --text-500: #64748b;
            --text-400: #94a3b8;
            --text-300: #cbd5e1;
            --text-contrast: #0f172a;
            --glass-panel-bg: rgba(255, 255, 255, 0.15);
            --glass-sidebar-bg: rgba(15, 23, 42, 0.6);
            --glass-column-bg: rgba(255, 255, 255, 0.2);
            --glass-card-bg: rgba(255, 255, 255, 0.75);
            --glass-card-hover-bg: rgba(255, 255, 255, 0.95);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-border-strong: rgba(255, 255, 255, 0.5);
        }

        .dark {
            --bg-color: #0b1220;
            --bg-image: linear-gradient(120deg,#0b1220 0%, #0f1724 40%, #0b1220 100%);
            --text-color: #e6eef8;
            /* Lighter slate tokens for dark theme readability */
            --text-800: #e6eef8;
            --text-700: #dbeafe;
            --text-600: #cfe9ff;
            --text-500: #9fb8d4;
            --text-400: #94a6b8;
            --text-300: #cddff6;
            --text-contrast: #0f172a;
            --glass-panel-bg: rgba(255, 255, 255, 0.03);
            --glass-sidebar-bg: rgba(2, 6, 23, 0.6);
            --glass-column-bg: rgba(255, 255, 255, 0.04);
            --glass-card-bg: rgba(20, 25, 33, 0.6);
            --glass-card-hover-bg: rgba(25, 30, 38, 0.8);
            --glass-border: rgba(255, 255, 255, 0.06);
            --glass-border-strong: rgba(255, 255, 255, 0.08);
        }

        body {
            font-family: 'Inter', sans-serif;
            /* Rich Mesh Gradient Background */
            background-color: var(--bg-color);
            background-image: var(--bg-image);
            background-attachment: fixed;
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: var(--text-color);
            overflow: hidden; /* Prevent body scroll, let main container scroll */
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Glass Utilities */
        .glass-panel {
            background: var(--glass-panel-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
        }

        .glass-sidebar {
            background: var(--glass-sidebar-bg); /* Darker glass for contrast */
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-right: 1px solid var(--glass-border);
        }

        .glass-column {
            background: var(--glass-column-bg);
            backdrop-filter: blur(16px);
            border-radius: 1rem;
            border: 1px solid var(--glass-border);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .glass-card {
            background: var(--glass-card-bg); /* More opaque for readability */
            backdrop-filter: blur(8px);
            border: 1px solid var(--glass-border-strong);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .glass-card:hover {
            background: var(--glass-card-hover-bg);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            border-color: rgba(255, 255, 255, 0.8);
        }

        .glass-header {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--glass-border);
        }

        .glass-modal {
            background: var(--glass-card-bg);
            backdrop-filter: blur(24px);
            border: 1px solid var(--glass-border-strong);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .glass-row:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent; 
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.4); 
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.6); 
        }

        /* Theme Toggle UI */
        .theme-toggle {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .toggle-switch {
            position: relative;
            width: 46px;
            height: 26px;
            display: inline-block;
        }
        .toggle-switch input { position: absolute; opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background-color: rgba(255,255,255,0.25);
            border-radius: 9999px;
            transition: background 0.2s ease;
        }
        .slider::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            left: 3px;
            top: 3px;
            background: white;
            border-radius: 9999px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            transition: transform 0.2s ease;
        }
        input:checked + .slider {
            background-color: rgba(59,130,246,0.9);
        }
        input:checked + .slider::after { transform: translateX(20px); }

        /* Map Tailwind slate text utilities to our variables so they adapt between themes */
        .text-slate-800 { color: var(--text-800) !important; }
        .text-slate-700 { color: var(--text-700) !important; }
        .text-slate-600 { color: var(--text-600) !important; }
        .text-slate-500 { color: var(--text-500) !important; }
        .text-slate-400 { color: var(--text-400) !important; }
        .text-slate-300 { color: var(--text-300) !important; }

        /* Keep readable contrast for light-background elements when dark theme is active */
        /* Prefer targeted overrides: don't globally change the text color for all elements with light backgrounds (it may contain colored text) */

        /* Also ensure nested text within these light backgrounds remain dark in dark theme */
        .dark .bg-white .text-slate-300, .dark .bg-white .text-slate-400, .dark .bg-white .text-slate-500, .dark .bg-white .text-slate-600, .dark .bg-white .text-slate-700, .dark .bg-white .text-slate-800,
        .dark .bg-white\/50 .text-slate-300, .dark .bg-white\/50 .text-slate-400, .dark .bg-white\/50 .text-slate-500, .dark .bg-white\/50 .text-slate-600, .dark .bg-white\/50 .text-slate-700, .dark .bg-white\/50 .text-slate-800,
        .dark .bg-white\/60 .text-slate-300, .dark .bg-white\/60 .text-slate-400, .dark .bg-white\/60 .text-slate-500, .dark .bg-white\/60 .text-slate-600, .dark .bg-white\/60 .text-slate-700, .dark .bg-white\/60 .text-slate-800,
        .dark .bg-slate-100 .text-slate-300, .dark .bg-slate-100 .text-slate-400, .dark .bg-slate-100 .text-slate-500, .dark .bg-slate-100 .text-slate-600, .dark .bg-slate-100 .text-slate-700, .dark .bg-slate-100 .text-slate-800,
        .dark .bg-slate-200 .text-slate-300, .dark .bg-slate-200 .text-slate-400, .dark .bg-slate-200 .text-slate-500, .dark .bg-slate-200 .text-slate-600, .dark .bg-slate-200 .text-slate-700, .dark .bg-slate-200 .text-slate-800 {
            color: var(--text-800) !important; /* force darker text for readability */
        }

        /* Keep 'COMPLETED' status and similar light-bg badges text dark in dark mode */
        .dark .bg-slate-100.text-slate-600,
        .dark .bg-white.text-slate-600,
        .dark .bg-white\/50.text-slate-600,
        .dark .bg-white\/40.text-slate-600 {
            color: var(--text-contrast) !important;
        }

        /* Ensure 'Complete Sprint' button or header close icon remain legible */
        .dark .bg-white\/60 .text-slate-500,
        .dark .bg-white\/60.text-slate-500 {
            color: var(--text-contrast) !important;
        }

        /* Also include lighter white tints (30/40) used in the UI */
        .dark .bg-white\/30 .text-slate-400, .dark .bg-white\/30 .text-slate-500, .dark .bg-white\/30 .text-slate-600,
        .dark .bg-white\/40 .text-slate-400, .dark .bg-white\/40 .text-slate-500, .dark .bg-white\/40 .text-slate-600 {
            color: var(--text-contrast) !important;
        }

        /* Always keep completed badge and 'Complete Sprint' button text dark for better contrast in both themes */
        .glass-panel .px-2.py-0\.5.rounded-full.text-slate-600,
        .glass-panel button.bg-white.text-slate-600,
        .glass-panel .bg-slate-100.text-slate-600 {
            color: var(--text-contrast) !important;
        }

        /* Also ensure the Clear Filter (bg-white text-slate-700) remains dark in both themes */
        .glass-panel button.bg-white.text-slate-700,
        .glass-panel button.bg-white\/50.text-slate-700,
        .glass-panel button.bg-white\/60.text-slate-700,
        .dark .glass-panel button.bg-white.text-slate-700,
        .dark .glass-panel button.bg-white\/50.text-slate-700,
        .dark .glass-panel button.bg-white\/60.text-slate-700 {
            color: var(--text-contrast) !important;
        }

        /* If the background and text classes are on the same element, ensure we keep dark text for readability */
        .dark .bg-white.text-slate-300, .dark .bg-white.text-slate-400, .dark .bg-white.text-slate-500, .dark .bg-white.text-slate-600, .dark .bg-white.text-slate-700, .dark .bg-white.text-slate-800,
        .dark .bg-white\/50.text-slate-300, .dark .bg-white\/50.text-slate-400, .dark .bg-white\/50.text-slate-500, .dark .bg-white\/50.text-slate-600, .dark .bg-white\/50.text-slate-700, .dark .bg-white\/50.text-slate-800,
        .dark .bg-white\/60.text-slate-300, .dark .bg-white\/60.text-slate-400, .dark .bg-white\/60.text-slate-500, .dark .bg-white\/60.text-slate-600, .dark .bg-white\/60.text-slate-700, .dark .bg-white\/60.text-slate-800,
        .dark .bg-slate-100.text-slate-300, .dark .bg-slate-100.text-slate-400, .dark .bg-slate-100.text-slate-500, .dark .bg-slate-100.text-slate-600, .dark .bg-slate-100.text-slate-700, .dark .bg-slate-100.text-slate-800,
        .dark .bg-slate-200.text-slate-300, .dark .bg-slate-200.text-slate-400, .dark .bg-slate-200.text-slate-500, .dark .bg-slate-200.text-slate-600, .dark .bg-slate-200.text-slate-700, .dark .bg-slate-200.text-slate-800 {
            color: var(--text-800) !important;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Authentication Helpers & Mock Storage ---
        const saveAuth = (profile) => {
            localStorage.setItem('jiraCloneAuth', 'true');
            localStorage.setItem('jiraCloneProfile', JSON.stringify(profile));
        };

        const clearAuth = () => {
            localStorage.removeItem('jiraCloneAuth');
            // keep profile in localStorage for convenience but remove flag
        };

        // --- Mock Data & Constants ---
        const INITIAL_DATA = [
            { id: 'PROJ-101', title: 'Setup React Architecture', description: 'Initialize repo and setup folder structure', status: 'done', priority: 'high', type: 'story', assignee: 'JD' },
            { id: 'PROJ-102', title: 'Design Database Schema', description: 'Draft initial ERD for the user and ticket tables', status: 'done', priority: 'medium', type: 'task', assignee: 'AS' },
            { id: 'PROJ-103', title: 'Fix Navigation Bug', description: 'Sidebar does not collapse on mobile view', status: 'inprogress', priority: 'high', type: 'bug', assignee: 'JD' },
            { id: 'PROJ-104', title: 'Implement Drag & Drop', description: 'Use HTML5 DnD API for the board', status: 'inprogress', priority: 'medium', type: 'story', assignee: 'AS' },
            { id: 'PROJ-105', title: 'User Authentication', description: 'Login and Registration screens', status: 'todo', priority: 'high', type: 'story', assignee: 'Unassigned' },
            { id: 'PROJ-106', title: 'Update Documentation', description: 'Update README.md with setup instructions', status: 'todo', priority: 'low', type: 'task', assignee: 'Unassigned' },
            { id: 'PROJ-107', title: 'Code Review', description: 'Review Pull Request #42', status: 'review', priority: 'medium', type: 'task', assignee: 'JD' },
        ];

        const INITIAL_SPRINTS = [
            { id: 1, name: 'Sprint 24 - Alpha', status: 'active', startDate: '2023-10-01', endDate: '2023-10-14', goal: 'Complete core user authentication and database setup.', progress: 65 },
            { id: 2, name: 'Sprint 25 - Beta', status: 'planned', startDate: '2023-10-15', endDate: '2023-10-28', goal: 'Implement main dashboard and reporting features.', progress: 0 },
            { id: 0, name: 'Sprint 23 - Foundation', status: 'completed', startDate: '2023-09-15', endDate: '2023-09-30', goal: 'Project initialization and repository setup.', progress: 100 },
        ];

        const INITIAL_COLUMNS = [
            { id: 'todo', title: 'To Do' },
            { id: 'inprogress', title: 'In Progress' },
            { id: 'review', title: 'In Review' },
            { id: 'done', title: 'Done' }
        ];

        const PRIORITIES = {
            low: { label: 'Low', color: 'text-blue-600 bg-blue-100/80', icon: 'ArrowDown', order: 1 },
            medium: { label: 'Medium', color: 'text-amber-600 bg-amber-100/80', icon: 'Minus', order: 2 },
            high: { label: 'High', color: 'text-rose-600 bg-rose-100/80', icon: 'ArrowUp', order: 3 }
        };

        const TYPES = {
            bug: { label: 'Bug', color: 'bg-rose-500', icon: 'Bug' },
            story: { label: 'Story', color: 'bg-emerald-500', icon: 'BookOpen' },
            task: { label: 'Task', color: 'bg-sky-500', icon: 'CheckSquare' }
        };

        // PieChart component using Chart.js (global Chart available via CDN)
        const PieChart = ({ typeCounts, size = 140, onSliceClick, selectedSlice }) => {
            const canvasRef = useRef(null);
            const chartRef = useRef(null);
            useEffect(() => {
                if (!canvasRef.current || !window.Chart) return;
                // register datalabels plugin if present
                if (window.Chart && window.ChartDataLabels) {
                    try { window.Chart.register(window.ChartDataLabels); } catch (e) {}
                }

                const ctx = canvasRef.current.getContext('2d');
                const data = [typeCounts.bug || 0, typeCounts.story || 0, typeCounts.task || 0];
                const labels = ['Bug', 'Story', 'Task'];
                const colors = ['#ef4444', '#10b981', '#0ea5e9']; // rose-500, emerald-500, sky-500
                const bgColors = labels.map((l, i) => {
                    if (!selectedSlice) return colors[i];
                    return (selectedSlice.toLowerCase() === labels[i].toLowerCase()) ? colors[i] : 'rgba(148,163,184,0.15)';
                });
                const offsets = labels.map((l, i) => {
                    if (!selectedSlice) return 0;
                    return (selectedSlice.toLowerCase() === labels[i].toLowerCase()) ? 8 : 0;
                });

                const chart = new window.Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels,
                        datasets: [{
                            data,
                            backgroundColor: bgColors,
                            borderColor: 'rgba(255,255,255,0.1)',
                            borderWidth: 1
                            , offset: (ctx) => offsets[ctx.dataIndex] || 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: { duration: 600, easing: 'easeOutQuart' },
                        plugins: {
                            legend: { display: false },
                            // tooltips are disabled because hover should not change display
                            tooltip: { enabled: false },
                                datalabels: {
                                color: '#ffffff',
                                formatter: function(value, ctx) {
                                    const dataArr = ctx.dataset.data;
                                    const total = dataArr.reduce((a, b) => a + b, 0) || 1;
                                    const percent = Math.round((value / total) * 100);
                                    return percent > 0 ? `${percent}%` : '';
                                },
                                font: { weight: 'bold', size: 12 }
                                }
                            
                        },
                        onClick: (evt, elements) => {
                            if (elements && elements.length > 0) {
                                const idx = elements[0].index;
                                const label = chart.data.labels[idx];
                                if (onSliceClick) onSliceClick(label);
                            }
                        }
                        
                    }
                });
                chartRef.current = chart;

                return () => { if (chart) chart.destroy(); chartRef.current = null; };
            }, [typeCounts, selectedSlice]);

            // If not authenticated, show a login page
            if (!isAuthenticated) {
                return (
                    <LoginPage
                        onSignIn={handleAuthSignIn}
                        onSignUp={handleAuthSignUp}
                        onGoogle={handleAuthGoogle}
                    />
                );
            }

            return (
                <div className="w-full h-full relative flex items-center justify-center" style={{ width: size, height: size }}>
                    <canvas ref={canvasRef} width={size} height={size} />
                </div>
            );
        };

        // --- Components ---

        const Icon = ({ name, size = 16, className = "" }) => {
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            }, [name]);
            return <i data-lucide={name} width={size} height={size} className={className}></i>;
        };

        const Sidebar = ({ onOpenBacklog, onOpenReports, onOpenSprints, onOpenProfile, isExpanded, toggleSidebar, userProfile }) => (
            <div className={`glass-sidebar h-screen flex flex-col fixed left-0 top-0 z-30 text-slate-300 transition-all duration-300 ease-in-out ${isExpanded ? 'w-64' : 'w-16'}`}>
                <div 
                    onClick={toggleSidebar}
                    className={`h-16 flex items-center cursor-pointer border-b border-white/10 hover:bg-white/5 transition-all ${isExpanded ? 'px-6 justify-start' : 'justify-center'}`}
                    title={isExpanded ? "Collapse Sidebar" : "Expand Sidebar"}
                >
                    <div className={`bg-blue-600/90 backdrop-blur-sm p-1.5 rounded-lg shadow-lg shadow-blue-500/20 transition-all duration-300 ${isExpanded ? 'mr-3' : 'mr-0'}`}>
                        <Icon name="layers" className="text-white" size={20} />
                    </div>
                    {isExpanded && (
                        <span className="font-bold text-white text-lg tracking-tight drop-shadow-sm animate-in fade-in duration-200">GlassBoard</span>
                    )}
                </div>
                
                <div className="flex-1 py-6 space-y-2 overflow-x-hidden">
                    {isExpanded && (
                        <div className="px-6 text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 animate-in fade-in duration-300">Planning</div>
                    )}
                    
                    <a href="#" className={`flex items-center py-2.5 bg-white/10 text-blue-300 border-r-2 border-blue-400 backdrop-blur-md transition-all duration-300 ${isExpanded ? 'px-6 justify-start' : 'justify-center'}`} title="Board">
                        <Icon name="kanban-square" size={20} />
                        {isExpanded && <span className="ml-3 font-medium animate-in fade-in duration-200">Board</span>}
                    </a>
                    
                    <button 
                        onClick={onOpenBacklog}
                        className={`w-full flex items-center py-2.5 hover:bg-white/5 hover:text-white transition-all duration-300 text-left ${isExpanded ? 'px-6 justify-start' : 'justify-center'}`}
                        title="Backlog & List"
                    >
                        <Icon name="list" size={20} />
                        {isExpanded && <span className="ml-3 font-medium animate-in fade-in duration-200">Backlog & List</span>}
                    </button>
                    
                    <button 
                        onClick={onOpenReports}
                        className={`w-full flex items-center py-2.5 hover:bg-white/5 hover:text-white transition-all duration-300 text-left ${isExpanded ? 'px-6 justify-start' : 'justify-center'}`}
                        title="Reports"
                    >
                        <Icon name="pie-chart" size={20} />
                        {isExpanded && <span className="ml-3 font-medium animate-in fade-in duration-200">Reports</span>}
                    </button>
                    
                    {isExpanded && (
                        <div className="mt-8 px-6 text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 animate-in fade-in duration-300">Development</div>
                    )}

                    <a href="#" className={`flex items-center py-2.5 hover:bg-white/5 hover:text-white transition-all duration-300 ${isExpanded ? 'px-6 justify-start' : 'justify-center'}`} title="Code">
                        <Icon name="code" size={20} />
                        {isExpanded && <span className="ml-3 font-medium animate-in fade-in duration-200">Code</span>}
                    </a>
                    <button 
                        onClick={onOpenSprints}
                        className={`w-full flex items-center py-2.5 hover:bg-white/5 hover:text-white transition-all duration-300 text-left ${isExpanded ? 'px-6 justify-start' : 'justify-center'}`}
                        title="Releases & Sprints"
                    >
                        <Icon name="rocket" size={20} />
                        {isExpanded && <span className="ml-3 font-medium animate-in fade-in duration-200">Releases</span>}
                    </button>
                </div>

                <div className="p-4 border-t border-white/10">
                    <div 
                        onClick={onOpenProfile}
                        className={`flex items-center cursor-pointer hover:bg-white/10 rounded-xl p-2 transition-all duration-200 ${isExpanded ? 'justify-start' : 'justify-center'}`}
                        title="View Profile"
                    >
                        <div className="w-8 h-8 rounded-full bg-gradient-to-tr from-pink-500 to-violet-500 shadow-lg flex items-center justify-center text-white font-bold text-xs ring-2 ring-white/20 flex-shrink-0">
                            {userProfile.initials}
                        </div>
                        {isExpanded && (
                            <div className="ml-3 animate-in fade-in duration-200 overflow-hidden">
                                <div className="text-sm font-medium text-white whitespace-nowrap">{userProfile.name}</div>
                                <div className="text-xs text-slate-400 whitespace-nowrap">{userProfile.role}</div>
                            </div>
                        )}
                    </div>
                </div>
            </div>
        );

        const TicketCard = ({ ticket, onDragStart, onClick }) => {
            const priorityConfig = PRIORITIES[ticket.priority];
            const typeConfig = TYPES[ticket.type];

            return (
                <div
                    draggable
                    onDragStart={(e) => onDragStart(e, ticket.id)}
                    onClick={() => onClick(ticket)}
                    className="glass-card p-3 rounded-xl cursor-grab active:cursor-grabbing group"
                >
                    <div className="flex justify-between items-start mb-2">
                        <span className="text-[10px] font-bold text-slate-500 hover:text-blue-600 transition-colors tracking-wide">{ticket.id}</span>
                        <div className="flex gap-2">
                             {ticket.assignee !== 'Unassigned' && (
                                <div className="w-6 h-6 rounded-full bg-gradient-to-br from-slate-100 to-slate-300 text-slate-700 flex items-center justify-center text-[10px] font-bold ring-2 ring-white shadow-sm">
                                    {ticket.assignee}
                                </div>
                             )}
                        </div>
                    </div>
                    
                    <h4 className="text-sm font-semibold text-slate-800 mb-3 line-clamp-2 leading-tight group-hover:text-blue-700 transition-colors">
                        {ticket.title}
                    </h4>

                    <div className="flex items-center justify-between mt-2">
                        <div className="flex items-center gap-2">
                             <div className={`w-5 h-5 rounded flex items-center justify-center text-white shadow-md ${typeConfig.color}`} title={typeConfig.label}>
                                <Icon name={typeConfig.icon} size={12} />
                             </div>
                             <div className={`px-2 py-0.5 rounded text-[10px] font-bold uppercase flex items-center gap-1 shadow-sm ${priorityConfig.color}`}>
                                {priorityConfig.label}
                             </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Components: Modals & Dashboards ---

        const CreateSprintModal = ({ isOpen, onClose, onSave }) => {
            if (!isOpen) return null;

            const [formData, setFormData] = useState({
                name: '',
                startDate: '',
                endDate: '',
                goal: ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave({
                    ...formData,
                    status: 'planned',
                    progress: 0
                });
                setFormData({ name: '', startDate: '', endDate: '', goal: '' });
                onClose();
            };

            return (
                <div className="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-in fade-in duration-200">
                    <div className="glass-modal rounded-2xl w-full max-w-lg overflow-hidden shadow-2xl">
                        <div className="bg-white/60 backdrop-blur-md border-b border-white/50 px-6 py-4 flex justify-between items-center">
                            <h3 className="text-lg font-bold text-slate-800">Create Sprint</h3>
                            <button onClick={onClose} className="p-2 hover:bg-white/50 text-slate-500 rounded-lg transition-colors">
                                <Icon name="x" size={20} />
                            </button>
                        </div>
                        <form onSubmit={handleSubmit} className="p-6 space-y-4">
                            <div>
                                <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Sprint Name</label>
                                <input 
                                    type="text" 
                                    required
                                    placeholder="Sprint 26 - Gamma"
                                    value={formData.name}
                                    onChange={(e) => setFormData({...formData, name: e.target.value})}
                                    className="w-full bg-white/50 border border-white/40 rounded-lg p-2.5 text-slate-800 text-sm focus:ring-2 focus:ring-blue-500/50 outline-none"
                                />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Start Date</label>
                                    <input 
                                        type="date" 
                                        required
                                        value={formData.startDate}
                                        onChange={(e) => setFormData({...formData, startDate: e.target.value})}
                                        className="w-full bg-white/50 border border-white/40 rounded-lg p-2.5 text-slate-800 text-sm focus:ring-2 focus:ring-blue-500/50 outline-none"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase mb-1">End Date</label>
                                    <input 
                                        type="date" 
                                        required
                                        value={formData.endDate}
                                        onChange={(e) => setFormData({...formData, endDate: e.target.value})}
                                        className="w-full bg-white/50 border border-white/40 rounded-lg p-2.5 text-slate-800 text-sm focus:ring-2 focus:ring-blue-500/50 outline-none"
                                    />
                                </div>
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Sprint Goal</label>
                                <textarea 
                                    rows="3"
                                    placeholder="What do we want to achieve?"
                                    value={formData.goal}
                                    onChange={(e) => setFormData({...formData, goal: e.target.value})}
                                    className="w-full bg-white/50 border border-white/40 rounded-lg p-2.5 text-slate-800 text-sm focus:ring-2 focus:ring-blue-500/50 outline-none"
                                ></textarea>
                            </div>
                            <div className="pt-4 flex justify-end gap-3">
                                <button type="button" onClick={onClose} className="px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg text-sm font-medium">Cancel</button>
                                <button type="submit" className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium shadow-lg">Create Sprint</button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        const SprintsDashboard = ({ isOpen, onClose, sprints, onUpdateStatus, onCreateSprint }) => {
            if (!isOpen) return null;

            const sortedSprints = [...sprints].sort((a, b) => {
                const statusOrder = { active: 1, planned: 2, completed: 3 };
                return statusOrder[a.status] - statusOrder[b.status];
            });

            return (
                <div className="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-in fade-in duration-200">
                    <div className="glass-modal rounded-2xl w-full max-w-5xl h-[85vh] flex flex-col overflow-hidden shadow-2xl">
                        <div className="bg-white/60 backdrop-blur-md border-b border-white/50 px-8 py-5 flex justify-between items-center z-10 shrink-0">
                            <div className="flex items-center gap-4">
                                <div className="bg-emerald-500 p-2.5 rounded-xl text-white shadow-lg shadow-emerald-500/30">
                                    <Icon name="rocket" size={24} />
                                </div>
                                <div>
                                    <h2 className="text-xl font-bold text-slate-800">Releases & Sprints</h2>
                                    <p className="text-sm text-slate-500">Manage sprint cycles and release timelines.</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-3">
                                <button 
                                    onClick={onCreateSprint}
                                    className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-lg transition-all flex items-center gap-2"
                                >
                                    <Icon name="plus" size={16} />
                                    Create Sprint
                                </button>
                                <button onClick={onClose} className="p-2 hover:bg-rose-50 hover:text-rose-500 text-slate-400 rounded-lg transition-colors">
                                    <Icon name="x" size={24} />
                                </button>
                            </div>
                        </div>

                        <div className="flex-1 overflow-y-auto custom-scrollbar bg-white/30 p-8">
                            <div className="grid grid-cols-1 gap-6">
                                {sortedSprints.map(sprint => (
                                    <div key={sprint.id} className="glass-panel p-6 rounded-xl relative overflow-hidden group">
                                        <div className={`absolute left-0 top-0 bottom-0 w-1.5 ${
                                            sprint.status === 'active' ? 'bg-green-500' : 
                                            sprint.status === 'planned' ? 'bg-blue-500' : 'bg-slate-400'
                                        }`}></div>

                                        <div className="flex justify-between items-start mb-4 pl-4">
                                            <div>
                                                <div className="flex items-center gap-3 mb-1">
                                                    <h3 className="text-lg font-bold text-slate-800">{sprint.name}</h3>
                                                    <span className={`text-[10px] uppercase font-bold px-2 py-0.5 rounded-full border ${
                                                        sprint.status === 'active' ? 'bg-green-50 text-green-700 border-green-200' : 
                                                        sprint.status === 'planned' ? 'bg-blue-50 text-blue-700 border-blue-200' : 
                                                        'bg-slate-100 text-slate-600 border-slate-200'
                                                    }`}>
                                                        {sprint.status}
                                                    </span>
                                                </div>
                                                <div className="text-sm text-slate-500 flex items-center gap-4">
                                                    <span className="flex items-center gap-1"><Icon name="calendar" size={14}/> {sprint.startDate} - {sprint.endDate}</span>
                                                </div>
                                            </div>
                                            
                                            <div className="flex gap-2">
                                                {sprint.status === 'active' && (
                                                    <button 
                                                        onClick={() => onUpdateStatus(sprint.id, 'completed')}
                                                        className="px-3 py-1.5 bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 rounded-lg text-xs font-bold transition-colors shadow-sm"
                                                    >
                                                        Complete Sprint
                                                    </button>
                                                )}
                                                {sprint.status === 'planned' && (
                                                    <button 
                                                        onClick={() => onUpdateStatus(sprint.id, 'active')}
                                                        className="px-3 py-1.5 bg-blue-600 text-white hover:bg-blue-700 rounded-lg text-xs font-bold transition-colors shadow-sm"
                                                    >
                                                        Start Sprint
                                                    </button>
                                                )}
                                            </div>
                                        </div>

                                        <div className="pl-4 mb-6">
                                            <p className="text-sm text-slate-600 bg-white/40 p-3 rounded-lg border border-white/30 italic">
                                                "{sprint.goal}"
                                            </p>
                                        </div>

                                        <div className="pl-4">
                                            <div className="flex justify-between text-xs font-bold text-slate-500 mb-1">
                                                <span>Progress</span>
                                                <span>{sprint.progress}%</span>
                                            </div>
                                            <div className="w-full bg-slate-200 rounded-full h-2">
                                                <div 
                                                    className={`h-2 rounded-full transition-all duration-1000 ${
                                                        sprint.status === 'active' ? 'bg-green-500' : 
                                                        sprint.status === 'completed' ? 'bg-slate-500' : 'bg-blue-500'
                                                    }`} 
                                                    style={{ width: `${sprint.progress}%` }}
                                                ></div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const AddMemberModal = ({ isOpen, onClose, onInvite, pendingInvites }) => {
            if (!isOpen) return null;

            const [formData, setFormData] = useState({ name: '', email: '', role: 'Member' });

            const handleSubmit = (e) => {
                e.preventDefault();
                onInvite(formData);
                setFormData({ name: '', email: '', role: 'Member' });
            };

            return (
                <div className="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-in fade-in duration-200">
                    <div className="glass-modal rounded-2xl w-full max-w-lg overflow-hidden shadow-2xl">
                        
                        <div className="bg-white/60 backdrop-blur-md border-b border-white/50 px-6 py-4 flex justify-between items-center">
                            <h3 className="text-lg font-bold text-slate-800 flex items-center gap-2">
                                <Icon name="user-plus" size={20} className="text-blue-600"/>
                                Add Team Members
                            </h3>
                            <button onClick={onClose} className="p-2 hover:bg-white/50 text-slate-500 rounded-lg transition-colors">
                                <Icon name="x" size={20} />
                            </button>
                        </div>

                        <div className="p-6">
                            <form onSubmit={handleSubmit} className="space-y-4 mb-8">
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Email Address</label>
                                    <input 
                                        type="email" 
                                        required
                                        placeholder="colleague@company.com"
                                        value={formData.email}
                                        onChange={(e) => setFormData({...formData, email: e.target.value})}
                                        className="w-full bg-white/50 border border-white/40 rounded-lg p-2.5 text-slate-800 text-sm focus:ring-2 focus:ring-blue-500/50 outline-none placeholder-slate-400"
                                    />
                                </div>
                                
                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Name (Optional)</label>
                                        <input 
                                            type="text" 
                                            placeholder="John Doe"
                                            value={formData.name}
                                            onChange={(e) => setFormData({...formData, name: e.target.value})}
                                            className="w-full bg-white/50 border border-white/40 rounded-lg p-2.5 text-slate-800 text-sm focus:ring-2 focus:ring-blue-500/50 outline-none"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Role</label>
                                        <select 
                                            value={formData.role}
                                            onChange={(e) => setFormData({...formData, role: e.target.value})}
                                            className="w-full bg-white/50 border border-white/40 rounded-lg p-2.5 text-slate-800 text-sm focus:ring-2 focus:ring-blue-500/50 outline-none"
                                        >
                                            <option>Member</option>
                                            <option>Admin</option>
                                            <option>Viewer</option>
                                        </select>
                                    </div>
                                </div>

                                <button 
                                    type="submit" 
                                    className="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2.5 rounded-lg shadow-lg shadow-blue-500/30 transition-all flex items-center justify-center gap-2"
                                >
                                    <Icon name="send" size={16} />
                                    Send Invitation
                                </button>
                            </form>

                            <div>
                                <h4 className="text-xs font-bold text-slate-400 uppercase mb-3 tracking-wider">Pending Invitations ({pendingInvites.length})</h4>
                                <div className="space-y-2 max-h-40 overflow-y-auto custom-scrollbar">
                                    {pendingInvites.map((invite, idx) => (
                                        <div key={idx} className="flex items-center justify-between p-3 bg-white/30 rounded-lg border border-white/20">
                                            <div className="flex items-center gap-3">
                                                <div className="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-xs font-bold text-slate-500">
                                                    {invite.email.charAt(0).toUpperCase()}
                                                </div>
                                                <div>
                                                    <div className="text-sm font-medium text-slate-700">{invite.email}</div>
                                                    <div className="text-[10px] text-slate-500">{invite.role}</div>
                                                </div>
                                            </div>
                                            <span className="text-xs text-blue-600 font-medium bg-blue-50 px-2 py-1 rounded">{invite.status}</span>
                                        </div>
                                    ))}
                                    {pendingInvites.length === 0 && <p className="text-sm text-slate-400 italic">No pending invites.</p>}
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            );
        };

        /* Sign In / Sign Up Modal Components */
        const SignInModal = ({ isOpen, onClose, onSignIn }) => {
            const [form, setForm] = useState({ email: '' });
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-60 flex items-center justify-center p-4 animate-in fade-in duration-200">
                    <div className="glass-modal rounded-2xl w-full max-w-md overflow-hidden shadow-2xl">
                        <div className="bg-white/60 backdrop-blur-md border-b border-white/50 px-6 py-4 flex justify-between items-center">
                            <h3 className="text-lg font-bold text-slate-800">Sign In</h3>
                            <button onClick={onClose} className="p-2 hover:bg-white/50 text-slate-500 rounded-lg transition-colors">X</button>
                        </div>
                        <div className="p-6">
                            <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Email</label>
                            <input type="email" value={form.email} onChange={(e) => setForm({...form, email: e.target.value})} className="w-full bg-white/50 border border-white/40 rounded-lg p-2.5 text-slate-800 text-sm" />
                            <div className="pt-4 flex justify-end gap-3">
                                <button onClick={onClose} className="px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg text-sm font-medium">Cancel</button>
                                <button onClick={() => { onSignIn(form); onClose(); }} className="px-4 py-2 bg-blue-600 text-white rounded-lg">Sign In</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const SignUpModal = ({ isOpen, onClose, onSignUp }) => {
            const [form, setForm] = useState({ name: '', email: '' });
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-60 flex items-center justify-center p-4 animate-in fade-in duration-200">
                    <div className="glass-modal rounded-2xl w-full max-w-md overflow-hidden shadow-2xl">
                        <div className="bg-white/60 backdrop-blur-md border-b border-white/50 px-6 py-4 flex justify-between items-center">
                            <h3 className="text-lg font-bold text-slate-800">Sign Up</h3>
                            <button onClick={onClose} className="p-2 hover:bg-white/50 text-slate-500 rounded-lg transition-colors">X</button>
                        </div>
                        <div className="p-6">
                            <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Full Name</label>
                            <input type="text" value={form.name} onChange={(e) => setForm({...form, name: e.target.value})} className="w-full bg-white/50 border border-white/40 rounded-lg p-2.5 text-slate-800 text-sm" />
                            <label className="block text-xs font-bold text-slate-500 uppercase mb-1 mt-4">Email</label>
                            <input type="email" value={form.email} onChange={(e) => setForm({...form, email: e.target.value})} className="w-full bg-white/50 border border-white/40 rounded-lg p-2.5 text-slate-800 text-sm" />
                            <div className="pt-4 flex justify-end gap-3">
                                <button onClick={onClose} className="px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg text-sm font-medium">Cancel</button>
                                <button onClick={() => { onSignUp(form); onClose(); }} className="px-4 py-2 bg-blue-600 text-white rounded-lg">Sign Up</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const LoginPage = ({ onSignIn, onSignUp, onGoogle }) => {
            const [isSignInOpen, setSignInOpen] = useState(false);
            const [isSignUpOpen, setSignUpOpen] = useState(false);

            const handleGoogle = () => {
                const email = prompt('Enter your Google email (simulated OAuth):');
                if (email) onGoogle(email);
            };

            return (
                <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-700 via-purple-700 to-pink-500">
                    <div className="glass-modal p-8 rounded-3xl w-full max-w-4xl flex items-center gap-8">
                        <div className="flex-1 text-white">
                            <h1 className="text-4xl font-bold mb-3">GlassBoard</h1>
                            <p className="mb-6 text-lg">Elegant board with glassmorphism. Sign in to continue.</p>
                            <button className="bg-white text-blue-600 px-6 py-3 rounded-lg font-bold shadow-md flex items-center gap-3" onClick={handleGoogle}>
                                <img src="https://www.svgrepo.com/show/355037/google.svg" alt="google" className="w-5 h-5" />
                                Continue with Google
                            </button>
                            <div className="mt-8 flex gap-3">
                                <button className="px-4 py-2 rounded-lg bg-white/10 text-white" onClick={() => setSignInOpen(true)}>Sign In</button>
                                <button className="px-4 py-2 rounded-lg bg-white text-blue-600 font-bold" onClick={() => setSignUpOpen(true)}>Sign Up</button>
                            </div>
                        </div>
                        <div className="hidden md:block w-56 h-56 bg-gradient-to-tr from-white/30 to-white/10 rounded-xl"></div>
                        <SignInModal isOpen={isSignInOpen} onClose={() => setSignInOpen(false)} onSignIn={onSignIn} />
                        <SignUpModal isOpen={isSignUpOpen} onClose={() => setSignUpOpen(false)} onSignUp={onSignUp} />
                    </div>
                </div>
            );
        };

        const SettingsModal = ({ isOpen, onClose, columns, onUpdateColumns, teamMembers, onRemoveMember, pendingInvites, onRevokeInvite, theme, onToggleTheme }) => {
            if (!isOpen) return null;

            const [activeTab, setActiveTab] = useState('board');
            const [editedColumns, setEditedColumns] = useState(columns);

            useEffect(() => {
                setEditedColumns(columns);
            }, [columns]);

            const handleColumnChange = (idx, field, value) => {
                const newCols = [...editedColumns];
                newCols[idx][field] = value;
                setEditedColumns(newCols);
            };

            const handleSaveBoard = () => {
                onUpdateColumns(editedColumns);
                alert('Board settings saved!');
            };

            return (
                <div className="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-in fade-in duration-200">
                    <div className="glass-modal rounded-2xl w-full max-w-3xl h-[70vh] flex flex-col overflow-hidden shadow-2xl">
                        
                        {/* Header */}
                        <div className="bg-white/60 backdrop-blur-md border-b border-white/50 px-6 py-4 flex justify-between items-center shrink-0">
                            <h3 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                                <Icon name="settings" size={24} className="text-slate-600"/>
                                Settings
                            </h3>
                            <button onClick={onClose} className="p-2 hover:bg-white/50 text-slate-500 rounded-lg transition-colors">
                                <Icon name="x" size={20} />
                            </button>
                        </div>

                        <div className="flex flex-1 overflow-hidden">
                            {/* Sidebar */}
                            <div className="w-48 bg-white/30 border-r border-white/20 p-4 flex flex-col gap-2">
                                <button 
                                    onClick={() => setActiveTab('board')}
                                    className={`text-left px-4 py-2 rounded-lg text-sm font-medium transition-colors ${activeTab === 'board' ? 'bg-blue-100 text-blue-700' : 'text-slate-600 hover:bg-white/40'}`}
                                >
                                    Board Settings
                                </button>
                                <button 
                                    onClick={() => setActiveTab('team')}
                                    className={`text-left px-4 py-2 rounded-lg text-sm font-medium transition-colors ${activeTab === 'team' ? 'bg-blue-100 text-blue-700' : 'text-slate-600 hover:bg-white/40'}`}
                                >
                                    Team Management
                                </button>
                                <button 
                                    onClick={() => setActiveTab('appearance')}
                                    className={`text-left px-4 py-2 rounded-lg text-sm font-medium transition-colors ${activeTab === 'appearance' ? 'bg-blue-100 text-blue-700' : 'text-slate-600 hover:bg-white/40'}`}
                                >
                                    Appearance
                                </button>
                            </div>

                            {/* Content Area */}
                            <div className="flex-1 p-8 overflow-y-auto custom-scrollbar bg-white/20">
                                {activeTab === 'board' && (
                                    <div className="space-y-6">
                                        <div>
                                            <h4 className="text-lg font-bold text-slate-700 mb-2">Board Columns</h4>
                                            <p className="text-sm text-slate-500 mb-4">Customize the stages of your workflow.</p>
                                            <div className="space-y-3">
                                                {editedColumns.map((col, idx) => (
                                                    <div key={col.id} className="flex items-center gap-3 bg-white/40 p-3 rounded-lg border border-white/30">
                                                        <span className="bg-slate-200 w-6 h-6 flex items-center justify-center rounded text-xs font-bold text-slate-600">{idx + 1}</span>
                                                        <input 
                                                            type="text" 
                                                            value={col.title}
                                                            onChange={(e) => handleColumnChange(idx, 'title', e.target.value)}
                                                            className="flex-1 bg-transparent border-b border-transparent focus:border-blue-500 outline-none text-sm font-semibold text-slate-700 px-2 py-1 hover:bg-white/20 rounded transition-all"
                                                        />
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                        <div className="pt-4 border-t border-white/20">
                                            <button 
                                                onClick={handleSaveBoard}
                                                className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium shadow-sm transition-colors flex items-center gap-2"
                                            >
                                                <Icon name="save" size={16} />
                                                Save Changes
                                            </button>
                                        </div>
                                    </div>
                                )}

                                {activeTab === 'team' && (
                                    <div className="space-y-8">
                                        
                                        {/* Active Members */}
                                        <div>
                                            <div className="flex justify-between items-center mb-4">
                                                <div>
                                                    <h4 className="text-lg font-bold text-slate-700">Active Members</h4>
                                                    <p className="text-sm text-slate-500">{teamMembers.length} people on this board</p>
                                                </div>
                                            </div>
                                            <div className="grid grid-cols-1 gap-3">
                                                {teamMembers.map((member, idx) => (
                                                    <div key={idx} className="flex items-center justify-between bg-white/40 p-3 rounded-lg border border-white/30">
                                                        <div className="flex items-center gap-3">
                                                            <div className="w-10 h-10 rounded-full bg-gradient-to-tr from-blue-400 to-indigo-500 flex items-center justify-center text-white font-bold text-sm shadow-sm">
                                                                {member}
                                                            </div>
                                                            <div>
                                                                <p className="text-sm font-bold text-slate-700">User {member}</p>
                                                                <p className="text-xs text-slate-500">Member</p>
                                                            </div>
                                                        </div>
                                                        <button 
                                                            onClick={() => onRemoveMember(idx)}
                                                            className="text-rose-500 hover:bg-rose-50 p-2 rounded-lg transition-colors text-xs font-medium"
                                                        >
                                                            Remove
                                                        </button>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Pending Invites */}
                                        <div>
                                            <h4 className="text-lg font-bold text-slate-700 mb-2">Pending Invitations</h4>
                                            <p className="text-sm text-slate-500 mb-4">{pendingInvites.length} invitations sent</p>
                                            
                                            <div className="space-y-3">
                                                {pendingInvites.map((invite, idx) => (
                                                    <div key={idx} className="flex items-center justify-between bg-white/40 p-3 rounded-lg border border-white/30 opacity-75">
                                                        <div className="flex items-center gap-3">
                                                            <div className="w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center text-slate-500 font-bold text-sm border-2 border-dashed border-slate-300">
                                                                <Icon name="mail" size={16} />
                                                            </div>
                                                            <div>
                                                                <p className="text-sm font-bold text-slate-700">{invite.email}</p>
                                                                <p className="text-xs text-slate-500">{invite.role}  {invite.status}</p>
                                                            </div>
                                                        </div>
                                                        <button 
                                                            onClick={() => onRevokeInvite(idx)}
                                                            className="text-slate-400 hover:text-rose-500 hover:bg-rose-50 p-2 rounded-lg transition-colors"
                                                            title="Revoke Invite"
                                                        >
                                                            <Icon name="trash-2" size={16} />
                                                        </button>
                                                    </div>
                                                ))}
                                                {pendingInvites.length === 0 && (
                                                    <div className="text-center py-4 border-2 border-dashed border-slate-200 rounded-lg text-slate-400 text-sm">
                                                        No pending invitations.
                                                    </div>
                                                )}
                                            </div>
                                        </div>

                                    </div>
                                )}

                                {activeTab === 'appearance' && (
                                    <div className="space-y-6">
                                        <div>
                                            <h4 className="text-lg font-bold text-slate-700 mb-2">Appearance</h4>
                                            <p className="text-sm text-slate-500 mb-4">Select a theme for the application interface.</p>

                                            <div className="flex items-center gap-4">
                                                <div className="theme-toggle items-center">
                                                    <label className="flex items-center gap-3">
                                                        <Icon name="sun" size={16} />
                                                        <span className="text-sm font-medium text-slate-700">Light</span>
                                                    </label>
                                                    <label className="ml-3 toggle-switch">
                                                        <input aria-label="Toggle dark mode" type="checkbox" checked={theme === 'dark'} onChange={onToggleTheme} />
                                                        <span className="slider"></span>
                                                    </label>
                                                    <label className="flex items-center gap-3 ml-3">
                                                        <Icon name="moon" size={16} />
                                                        <span className="text-sm font-medium text-slate-700">Dark</span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const ProfileDashboard = ({ isOpen, onClose, profile, onSave, onSignOut }) => {
            if (!isOpen) return null;

            const [isEditing, setIsEditing] = useState(false);
            const [formData, setFormData] = useState(profile);

            // Reset form data when profile changes or modal opens
            useEffect(() => {
                setFormData(profile);
                setIsEditing(false);
            }, [profile, isOpen]);

            const handleSave = (e) => {
                e.preventDefault();
                onSave(formData);
                setIsEditing(false);
            };

            return (
                <div className="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-in fade-in duration-200">
                    <div className="glass-modal rounded-2xl w-full max-w-2xl h-auto max-h-[90vh] flex flex-col overflow-hidden shadow-2xl relative">
                        
                        {/* Header/Banner Area */}
                        <div className="h-32 bg-gradient-to-r from-blue-500/20 via-purple-500/20 to-pink-500/20 relative">
                             <button onClick={onClose} className="absolute top-4 right-4 p-2 hover:bg-white/20 text-white rounded-full transition-colors z-10">
                                <Icon name="x" size={24} />
                            </button>
                        </div>

                        {/* Profile Content */}
                        <div className="px-8 pb-8 -mt-12 flex-1 overflow-y-auto custom-scrollbar">
                            <div className="flex justify-between items-end mb-6">
                                <div className="w-24 h-24 rounded-2xl bg-gradient-to-tr from-pink-500 to-violet-500 shadow-xl flex items-center justify-center text-white font-bold text-3xl ring-4 ring-white/20">
                                    {formData.initials}
                                </div>
                                {!isEditing ? (
                                    <>
                                        <button 
                                            onClick={() => setIsEditing(true)}
                                            className="bg-white/10 hover:bg-white/20 text-slate-700 px-4 py-2 rounded-lg text-sm font-medium border border-white/20 backdrop-blur-sm transition-all flex items-center gap-2"
                                        >
                                            <Icon name="edit-2" size={16} />
                                            Edit Profile
                                        </button>
                                        <button onClick={() => { if (onSignOut) onSignOut(); }} className="bg-rose-50 text-rose-600 px-3 py-2 rounded-lg">Sign Out</button>
                                    </>
                                ) : (
                                    <div className="flex gap-2">
                                        <button 
                                            onClick={() => setIsEditing(false)}
                                            className="px-4 py-2 rounded-lg text-sm font-medium text-slate-600 hover:bg-slate-100 transition-colors"
                                        >
                                            Cancel
                                        </button>
                                        <button 
                                            onClick={handleSave}
                                            className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium shadow-lg shadow-blue-500/30 transition-all flex items-center gap-2"
                                        >
                                            <Icon name="check" size={16} />
                                            Save Changes
                                        </button>
                                        <button 
                                            onClick={() => { if (onSignOut) onSignOut(); }}
                                            className="px-4 py-2 bg-white text-slate-700 rounded-lg hover:bg-white/80 transition-all shadow-sm"
                                            title="Sign out"
                                        >
                                            Sign Out
                                        </button>
                                    </div>
                                )}
                            </div>

                            {isEditing ? (
                                <form onSubmit={handleSave} className="space-y-5 animate-in fade-in duration-200">
                                    <div className="grid grid-cols-2 gap-5">
                                        <div className="space-y-1">
                                            <label className="text-xs font-bold text-slate-500 uppercase">Full Name</label>
                                            <input 
                                                type="text" 
                                                value={formData.name}
                                                onChange={(e) => setFormData({...formData, name: e.target.value})}
                                                className="w-full bg-white/50 border border-white/40 rounded-lg p-2.5 text-slate-800 text-sm focus:ring-2 focus:ring-blue-500/50 outline-none"
                                            />
                                        </div>
                                        <div className="space-y-1">
                                            <label className="text-xs font-bold text-slate-500 uppercase">Initials</label>
                                            <input 
                                                type="text" 
                                                value={formData.initials}
                                                maxLength={2}
                                                onChange={(e) => setFormData({...formData, initials: e.target.value.toUpperCase()})}
                                                className="w-full bg-white/50 border border-white/40 rounded-lg p-2.5 text-slate-800 text-sm focus:ring-2 focus:ring-blue-500/50 outline-none"
                                            />
                                        </div>
                                    </div>

                                    <div className="space-y-1">
                                        <label className="text-xs font-bold text-slate-500 uppercase">Role / Job Title</label>
                                        <input 
                                            type="text" 
                                            value={formData.role}
                                            onChange={(e) => setFormData({...formData, role: e.target.value})}
                                            className="w-full bg-white/50 border border-white/40 rounded-lg p-2.5 text-slate-800 text-sm focus:ring-2 focus:ring-blue-500/50 outline-none"
                                        />
                                    </div>

                                    <div className="grid grid-cols-2 gap-5">
                                        <div className="space-y-1">
                                            <label className="text-xs font-bold text-slate-500 uppercase">Email</label>
                                            <input 
                                                type="email" 
                                                value={formData.email}
                                                onChange={(e) => setFormData({...formData, email: e.target.value})}
                                                className="w-full bg-white/50 border border-white/40 rounded-lg p-2.5 text-slate-800 text-sm focus:ring-2 focus:ring-blue-500/50 outline-none"
                                            />
                                        </div>
                                        <div className="space-y-1">
                                            <label className="text-xs font-bold text-slate-500 uppercase">Location</label>
                                            <input 
                                                type="text" 
                                                value={formData.location}
                                                onChange={(e) => setFormData({...formData, location: e.target.value})}
                                                className="w-full bg-white/50 border border-white/40 rounded-lg p-2.5 text-slate-800 text-sm focus:ring-2 focus:ring-blue-500/50 outline-none"
                                            />
                                        </div>
                                    </div>

                                    <div className="space-y-1">
                                        <label className="text-xs font-bold text-slate-500 uppercase">Bio</label>
                                        <textarea 
                                            rows="4"
                                            value={formData.bio}
                                            onChange={(e) => setFormData({...formData, bio: e.target.value})}
                                            className="w-full bg-white/50 border border-white/40 rounded-lg p-2.5 text-slate-800 text-sm focus:ring-2 focus:ring-blue-500/50 outline-none"
                                        ></textarea>
                                    </div>
                                </form>
                            ) : (
                                <div className="space-y-6 animate-in fade-in duration-200">
                                    <div>
                                        <h2 className="text-2xl font-bold text-slate-800">{formData.name}</h2>
                                        <p className="text-slate-500 font-medium">{formData.role}</p>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="glass-panel p-4 rounded-xl flex items-center gap-3">
                                            <div className="p-2 bg-blue-100 text-blue-600 rounded-lg">
                                                <Icon name="mail" size={18} />
                                            </div>
                                            <div className="overflow-hidden">
                                                <p className="text-xs text-slate-500 uppercase font-bold">Email</p>
                                                <p className="text-sm text-slate-700 truncate">{formData.email}</p>
                                            </div>
                                        </div>
                                        <div className="glass-panel p-4 rounded-xl flex items-center gap-3">
                                            <div className="p-2 bg-purple-100 text-purple-600 rounded-lg">
                                                <Icon name="map-pin" size={18} />
                                            </div>
                                            <div>
                                                <p className="text-xs text-slate-500 uppercase font-bold">Location</p>
                                                <p className="text-sm text-slate-700">{formData.location}</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="glass-panel p-5 rounded-xl">
                                        <p className="text-xs text-slate-500 uppercase font-bold mb-2">About</p>
                                        <p className="text-sm text-slate-700 leading-relaxed">
                                            {formData.bio}
                                        </p>
                                    </div>

                                    <div className="flex gap-4 pt-2">
                                        <div className="text-center flex-1 p-3 rounded-xl bg-white/20">
                                            <div className="text-xl font-bold text-slate-800">12</div>
                                            <div className="text-xs text-slate-500 font-medium">Active Tasks</div>
                                        </div>
                                        <div className="text-center flex-1 p-3 rounded-xl bg-white/20">
                                            <div className="text-xl font-bold text-slate-800">48</div>
                                            <div className="text-xs text-slate-500 font-medium">Completed</div>
                                        </div>
                                        <div className="text-center flex-1 p-3 rounded-xl bg-white/20">
                                            <div className="text-xl font-bold text-slate-800">5</div>
                                            <div className="text-xs text-slate-500 font-medium">Projects</div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const ListDashboard = ({ isOpen, onClose, tickets, onTicketClick, columns }) => {
            if (!isOpen) return null;

            const [sortType, setSortType] = useState('priority-desc');

            const sortedTickets = useMemo(() => {
                const sorted = [...tickets];
                switch(sortType) {
                    case 'priority-desc':
                        return sorted.sort((a, b) => PRIORITIES[b.priority].order - PRIORITIES[a.priority].order);
                    case 'priority-asc':
                        return sorted.sort((a, b) => PRIORITIES[a.priority].order - PRIORITIES[b.priority].order);
                    case 'status':
                        return sorted.sort((a, b) => a.status.localeCompare(b.status));
                    case 'id':
                        return sorted.sort((a, b) => a.id.localeCompare(b.id));
                    default:
                        return sorted;
                }
            }, [tickets, sortType]);

            return (
                <div className="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-in fade-in duration-200">
                    <div className="glass-modal rounded-2xl w-full max-w-5xl h-[85vh] flex flex-col overflow-hidden shadow-2xl">
                        
                        <div className="bg-white/60 backdrop-blur-md border-b border-white/50 px-8 py-5 flex justify-between items-center z-10 shrink-0">
                            <div className="flex items-center gap-4">
                                <div className="bg-blue-500 p-2.5 rounded-xl text-white shadow-lg shadow-blue-500/30">
                                    <Icon name="list-checks" size={24} />
                                </div>
                                <div>
                                    <h2 className="text-xl font-bold text-slate-800">Backlog & Priority List</h2>
                                    <p className="text-sm text-slate-500">All tickets across all statuses in one view.</p>
                                </div>
                            </div>
                            
                            <div className="flex items-center gap-4">
                                <div className="flex items-center gap-2 bg-white/40 p-1 rounded-lg border border-white/50">
                                    <span className="text-xs font-bold text-slate-500 px-2">SORT BY:</span>
                                    <select 
                                        value={sortType}
                                        onChange={(e) => setSortType(e.target.value)}
                                        className="bg-transparent border-none text-sm font-semibold text-slate-700 focus:ring-0 cursor-pointer py-1 pr-8 pl-2"
                                    >
                                        <option value="priority-desc">Priority (High  Low)</option>
                                        <option value="priority-asc">Priority (Low  High)</option>
                                        <option value="status">Status</option>
                                        <option value="id">Ticket ID</option>
                                    </select>
                                </div>
                                <button onClick={onClose} className="p-2 hover:bg-rose-50 hover:text-rose-500 text-slate-400 rounded-lg transition-colors">
                                    <Icon name="x" size={24} />
                                </button>
                            </div>
                        </div>

                        <div className="flex-1 overflow-y-auto custom-scrollbar bg-white/30">
                            <div className="min-w-full inline-block align-middle">
                                <div className="border-b border-white/20">
                                    <div className="flex px-8 py-3 bg-white/20 text-xs font-bold text-slate-500 uppercase tracking-wider border-b border-white/30 backdrop-blur-sm sticky top-0 z-10">
                                        <div className="w-24">ID</div>
                                        <div className="w-24">Type</div>
                                        <div className="flex-1">Title</div>
                                        <div className="w-32">Status</div>
                                        <div className="w-32">Priority</div>
                                        <div className="w-24">Assignee</div>
                                    </div>

                                    <div className="divide-y divide-white/30">
                                        {sortedTickets.map((ticket) => {
                                            const priority = PRIORITIES[ticket.priority];
                                            const type = TYPES[ticket.type];
                                            const status = columns.find(c => c.id === ticket.status);

                                            return (
                                                <div 
                                                    key={ticket.id}
                                                    onClick={() => onTicketClick(ticket)}
                                                    className="glass-row flex items-center px-8 py-4 cursor-pointer transition-colors group"
                                                >
                                                    <div className="w-24 text-xs font-bold text-slate-500 group-hover:text-blue-600">{ticket.id}</div>
                                                    <div className="w-24">
                                                        <div className={`w-6 h-6 rounded flex items-center justify-center text-white shadow-sm ${type.color}`} title={type.label}>
                                                            <Icon name={type.icon} size={14} />
                                                        </div>
                                                    </div>
                                                    <div className="flex-1 pr-4">
                                                        <div className="text-sm font-semibold text-slate-800 group-hover:text-blue-700">{ticket.title}</div>
                                                        <div className="text-xs text-slate-500 truncate max-w-md opacity-0 group-hover:opacity-100 transition-opacity">{ticket.description}</div>
                                                    </div>
                                                    <div className="w-32">
                                                        <span className="px-2 py-1 rounded text-[10px] font-bold uppercase bg-white/50 border border-white/50 text-slate-600">
                                                            {status ? status.title : ticket.status}
                                                        </span>
                                                    </div>
                                                    <div className="w-32">
                                                        <div className={`inline-flex items-center gap-1.5 px-2 py-1 rounded text-xs font-bold border border-transparent ${priority.color}`}>
                                                            <Icon name={priority.icon} size={12} />
                                                            {priority.label}
                                                        </div>
                                                    </div>
                                                    <div className="w-24 flex items-center">
                                                         {ticket.assignee !== 'Unassigned' ? (
                                                            <div className="flex items-center gap-2">
                                                                <div className="w-6 h-6 rounded-full bg-slate-200 flex items-center justify-center text-[10px] font-bold text-slate-600">
                                                                    {ticket.assignee}
                                                                </div>
                                                                <span className="text-xs text-slate-600">{ticket.assignee}</span>
                                                            </div>
                                                         ) : (
                                                             <span className="text-xs text-slate-400 italic">--</span>
                                                         )}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div className="bg-white/40 border-t border-white/50 px-8 py-3 text-xs text-slate-500 font-medium flex justify-between backdrop-blur-md">
                            <span>Total Issues: {sortedTickets.length}</span>
                            <div className="flex gap-4">
                                <span className="flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-rose-500"></div> High: {tickets.filter(t => t.priority === 'high').length}</span>
                                <span className="flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-amber-500"></div> Med: {tickets.filter(t => t.priority === 'medium').length}</span>
                                <span className="flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-blue-500"></div> Low: {tickets.filter(t => t.priority === 'low').length}</span>
                            </div>
                        </div>

                    </div>
                </div>
            );
        };

        const ReportsDashboard = ({ isOpen, onClose, tickets, columns }) => {
            if (!isOpen) return null;

            const [selectedType, setSelectedType] = useState(null);
            const totalTickets = (selectedType ? tickets.filter(t => t.type === selectedType) : tickets).length;
            
            const filteredTickets = selectedType ? tickets.filter(t => t.type === selectedType) : tickets;
            const statusData = columns.map(col => ({
                ...col,
                count: filteredTickets.filter(t => t.status === col.id).length,
                percent: totalTickets ? Math.round((filteredTickets.filter(t => t.status === col.id).length / totalTickets) * 100) : 0
            }));

            const priorityCounts = {
                high: filteredTickets.filter(t => t.priority === 'high').length,
                medium: filteredTickets.filter(t => t.priority === 'medium').length,
                low: filteredTickets.filter(t => t.priority === 'low').length,
            };

            // Keep pie chart based on global counts (unfiltered) so it shows distribution of all types
            const globalTypeCounts = {
                bug: tickets.filter(t => t.type === 'bug').length,
                story: tickets.filter(t => t.type === 'story').length,
                task: tickets.filter(t => t.type === 'task').length,
            };
            const typeCounts = {
                bug: filteredTickets.filter(t => t.type === 'bug').length,
                story: filteredTickets.filter(t => t.type === 'story').length,
                task: filteredTickets.filter(t => t.type === 'task').length,
            };

            const assigneeData = Object.entries(
                filteredTickets.reduce((acc, t) => {
                    acc[t.assignee] = (acc[t.assignee] || 0) + 1;
                    return acc;
                }, {})
            ).sort((a, b) => b[1] - a[1]);

            return (
                <div className="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-in fade-in duration-200">
                    <div className="glass-modal rounded-2xl w-full max-w-6xl h-[90vh] flex flex-col overflow-hidden shadow-2xl">
                        
                        <div className="bg-white/60 backdrop-blur-md border-b border-white/50 px-8 py-5 flex justify-between items-center z-10 shrink-0">
                            <div className="flex items-center gap-4">
                                <div className="bg-purple-500 p-2.5 rounded-xl text-white shadow-lg shadow-purple-500/30">
                                    <Icon name="pie-chart" size={24} />
                                </div>
                                <div>
                                    <h2 className="text-xl font-bold text-slate-800">Project Analytics</h2>
                                    <p className="text-sm text-slate-500">Real-time overview of project health and velocity.</p>
                                    {selectedType && (
                                        <div className="mt-1">
                                            <span className="px-2 py-0.5 rounded-full bg-white/20 text-slate-100 text-xs font-semibold">Filtered: {selectedType.charAt(0).toUpperCase() + selectedType.slice(1)}</span>
                                        </div>
                                    )}
                                </div>
                            </div>
                            <button onClick={onClose} className="p-2 hover:bg-rose-50 hover:text-rose-500 text-slate-400 rounded-lg transition-colors">
                                <Icon name="x" size={24} />
                            </button>
                        </div>

                        <div className="flex-1 overflow-y-auto custom-scrollbar bg-white/30 p-8">
                            
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                                <div className="glass-panel p-6 rounded-xl flex items-center justify-between">
                                    <div>
                                        <p className="text-sm font-bold text-slate-500 uppercase">Total Issues</p>
                                        <p className="text-3xl font-bold text-slate-800">{totalTickets}</p>
                                    </div>
                                    <div className="bg-blue-100 p-3 rounded-full text-blue-600">
                                        <Icon name="layers" size={24} />
                                    </div>
                                </div>
                                <div className="glass-panel p-6 rounded-xl flex items-center justify-between">
                                    <div>
                                        <p className="text-sm font-bold text-slate-500 uppercase">Completed</p>
                                        <p className="text-3xl font-bold text-emerald-600">{statusData.find(s => s.id === 'done')?.count || 0}</p>
                                    </div>
                                    <div className="bg-emerald-100 p-3 rounded-full text-emerald-600">
                                        <Icon name="check-circle" size={24} />
                                    </div>
                                </div>
                                <div className="glass-panel p-6 rounded-xl flex items-center justify-between">
                                    <div>
                                        <p className="text-sm font-bold text-slate-500 uppercase">High Priority</p>
                                        <p className="text-3xl font-bold text-rose-600">{priorityCounts.high}</p>
                                    </div>
                                    <div className="bg-rose-100 p-3 rounded-full text-rose-600">
                                        <Icon name="alert-circle" size={24} />
                                    </div>
                                </div>
                                <div className="glass-panel p-6 rounded-xl flex items-center justify-between">
                                    <div>
                                        <p className="text-sm font-bold text-slate-500 uppercase">Team Size</p>
                                        <p className="text-3xl font-bold text-purple-600">{assigneeData.filter(a => a[0] !== 'Unassigned').length}</p>
                                    </div>
                                    <div className="bg-purple-100 p-3 rounded-full text-purple-600">
                                        <Icon name="users" size={24} />
                                    </div>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                
                                <div className="glass-panel p-6 rounded-xl">
                                    <h3 className="text-lg font-bold text-slate-700 mb-6 flex items-center gap-2">
                                        <Icon name="bar-chart-2" size={20} /> Status Distribution
                                    </h3>
                                    <div className="space-y-4">
                                        {statusData.map(status => (
                                            <div key={status.id}>
                                                <div className="flex justify-between text-sm font-medium mb-1">
                                                    <span className="text-slate-600">{status.title}</span>
                                                    <span className="text-slate-800">{status.count} ({status.percent}%)</span>
                                                </div>
                                                <div className="w-full bg-slate-200/50 rounded-full h-2.5 backdrop-blur-sm">
                                                    <div 
                                                        className="h-2.5 rounded-full transition-all duration-500" 
                                                        style={{ 
                                                            width: `${status.percent}%`,
                                                            backgroundColor: status.id === 'done' ? '#10b981' : 
                                                                            status.id === 'inprogress' ? '#3b82f6' : 
                                                                            status.id === 'review' ? '#8b5cf6' : '#94a3b8' 
                                                        }}
                                                    ></div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div className="glass-panel p-6 rounded-xl">
                                    <h3 className="text-lg font-bold text-slate-700 mb-6 flex items-center gap-2">
                                        <Icon name="activity" size={20} /> Priority Breakdown
                                    </h3>
                                    <div className="flex items-end justify-around h-48 pt-4 space-x-4">
                                        {['low', 'medium', 'high'].map(p => {
                                            const count = priorityCounts[p];
                                            const max = Math.max(priorityCounts.low, priorityCounts.medium, priorityCounts.high, 1);
                                            const height = Math.max((count / max) * 100, 5); 
                                            const config = PRIORITIES[p];
                                            
                                            return (
                                                <div key={p} className="flex flex-col items-center w-full group">
                                                    <div className="relative w-full max-w-[60px] bg-slate-100/50 rounded-t-lg overflow-hidden flex items-end h-40">
                                                        <div 
                                                            className={`w-full transition-all duration-700 ${config.color.split(' ')[1].replace('/80', '')}`}
                                                            style={{ height: `${height}%` }}
                                                        ></div>
                                                        <div className="absolute top-0 w-full text-center mt-2 text-sm font-bold text-slate-600 opacity-0 group-hover:opacity-100 transition-opacity">
                                                            {count}
                                                        </div>
                                                    </div>
                                                    <span className="mt-3 text-xs font-bold uppercase text-slate-500">{config.label}</span>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>

                                <div className="glass-panel p-6 rounded-xl">
                                    <h3 className="text-lg font-bold text-slate-700 mb-6 flex items-center gap-2">
                                        <Icon name="user-check" size={20} /> Workload by Assignee
                                    </h3>
                                    <div className="space-y-4 max-h-60 overflow-y-auto custom-scrollbar pr-2">
                                        {assigneeData.map(([user, count]) => {
                                            const percent = Math.round((count / totalTickets) * 100);
                                            return (
                                                <div key={user} className="flex items-center gap-4">
                                                    <div className="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-xs font-bold text-slate-600 shrink-0">
                                                        {user === 'Unassigned' ? '?' : user}
                                                    </div>
                                                    <div className="flex-1">
                                                        <div className="flex justify-between text-xs font-medium mb-1">
                                                            <span className="text-slate-700">{user}</span>
                                                            <span className="text-slate-500">{count} tickets</span>
                                                        </div>
                                                        <div className="w-full bg-slate-200/50 rounded-full h-1.5">
                                                            <div 
                                                                className="h-1.5 rounded-full bg-indigo-500" 
                                                                style={{ width: `${percent}%` }}
                                                            ></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>

                                <div className="glass-panel p-6 rounded-xl">
                                    <h3 className="text-lg font-bold text-slate-700 mb-6 flex items-center gap-2">
                                        <Icon name="tag" size={20} /> Issue Types
                                    </h3>
                                    <div className="flex flex-col lg:flex-row items-center justify-center gap-6 text-center">
                                        <div className="flex items-center gap-6">
                                            <div className="w-48 h-48 flex items-center justify-center">
                                                <PieChart typeCounts={globalTypeCounts} size={140} onSliceClick={(label) => {
                                                    const key = label.toLowerCase();
                                                    setSelectedType(prev => prev === key ? null : key);
                                                }} selectedSlice={selectedType ? selectedType.charAt(0).toUpperCase() + selectedType.slice(1) : null} />
                                            </div>
                                            <div className="flex flex-col gap-2">
                                                {Object.entries(globalTypeCounts).map(([type, count]) => {
                                                    const config = TYPES[type];
                                                    const colorMap = { bug: 'bg-rose-100 text-rose-600', story: 'bg-emerald-100 text-emerald-600', task: 'bg-sky-100 text-sky-600' };
                                                    const boxColor = colorMap[type] || 'bg-sky-100 text-sky-600';
                                                    // show percent and count relative to global totals
                                                    const total = Object.values(globalTypeCounts).reduce((s, v) => s + v, 0) || 1;
                                                    const percent = Math.round((count / total) * 100);
                                                    return (
                                                        <div key={type} className="flex items-center gap-3">
                                                            <div className={`w-3 h-3 rounded ${config.color}`}></div>
                                                            <div className="text-sm font-bold text-slate-700 capitalize">{config.label}</div>
                                                            <div className="text-sm text-slate-500">{count}</div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    </div>
                                    {selectedType && (
                                        <div className="mt-4 text-center">
                                            <button className="px-3 py-1.5 bg-white border border-slate-200 text-slate-700 hover:bg-slate-50 rounded-lg text-xs font-bold transition-colors shadow-sm" onClick={() => setSelectedType(null)}>
                                                Clear Filter
                                            </button>
                                        </div>
                                    )}
                                </div>

                            </div>
                        </div>

                    </div>
                </div>
            );
        };

        const TicketModal = ({ isOpen, onClose, ticket, onSave, onDelete, columns }) => {
            if (!isOpen) return null;

            const [formData, setFormData] = useState({
                title: '', description: '', status: 'todo', priority: 'medium', type: 'task', assignee: 'Unassigned'
            });
            
            const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);

            useEffect(() => {
                if (ticket) {
                    setFormData(ticket);
                    setShowDeleteConfirm(false); 
                } else {
                    setFormData({ title: '', description: '', status: 'todo', priority: 'medium', type: 'task', assignee: 'Unassigned' });
                }
            }, [ticket]);

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave({ ...formData, id: ticket ? ticket.id : `PROJ-${Math.floor(Math.random() * 10000)}` });
            };

            return (
                <div className="fixed inset-0 bg-slate-900/30 backdrop-blur-[2px] z-50 flex items-center justify-center p-4 animate-in fade-in duration-200">
                    <div className="glass-modal rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                        <div className="sticky top-0 bg-white/60 backdrop-blur-md border-b border-white/50 px-6 py-4 flex justify-between items-center z-10">
                            <div className="flex items-center gap-2 text-slate-500 text-sm font-medium">
                                {ticket && ticket.id ? ticket.id : 'New Issue'}
                            </div>
                            <div className="flex items-center gap-2">
                                {ticket && ticket.id && !ticket.isDraft && (
                                    showDeleteConfirm ? (
                                        <div className="flex items-center gap-2 mr-2 bg-rose-50 px-2 py-1 rounded-lg border border-rose-100">
                                            <span className="text-xs text-rose-600 font-bold">Delete?</span>
                                            <button 
                                                onClick={() => onDelete(ticket.id)}
                                                className="px-2 py-0.5 bg-rose-500 hover:bg-rose-600 text-white text-xs font-bold rounded transition-colors shadow-sm"
                                            >
                                                Yes
                                            </button>
                                            <button 
                                                onClick={() => setShowDeleteConfirm(false)}
                                                className="px-2 py-0.5 bg-white hover:bg-slate-50 text-slate-600 text-xs font-bold rounded border border-slate-200 transition-colors"
                                            >
                                                No
                                            </button>
                                        </div>
                                    ) : (
                                        <button 
                                            onClick={() => setShowDeleteConfirm(true)} 
                                            className="p-2 hover:bg-rose-50 text-slate-400 hover:text-rose-600 rounded-lg transition-colors" 
                                            title="Delete"
                                        >
                                            <Icon name="trash-2" size={18} />
                                        </button>
                                    )
                                )}
                                <button onClick={onClose} className="p-2 hover:bg-white/50 text-slate-500 rounded-lg transition-colors">
                                    <Icon name="x" size={20} />
                                </button>
                            </div>
                        </div>

                        <form onSubmit={handleSubmit} className="p-6 space-y-6">
                            <div className="space-y-2">
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-wider">Summary</label>
                                <input
                                    type="text"
                                    required
                                    value={formData.title}
                                    onChange={(e) => setFormData({...formData, title: e.target.value})}
                                    className="w-full text-xl font-bold text-slate-800 bg-transparent border-none focus:ring-0 focus:outline-none placeholder-slate-400 p-0"
                                    placeholder="What needs to be done?"
                                />
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-xs font-bold text-slate-500 uppercase mb-1.5">Status</label>
                                        <select
                                            value={formData.status}
                                            onChange={(e) => setFormData({...formData, status: e.target.value})}
                                            className="w-full bg-white/50 border border-white/60 text-slate-700 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 shadow-sm backdrop-blur-sm"
                                        >
                                            {columns.map(c => <option key={c.id} value={c.id}>{c.title}</option>)}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-slate-500 uppercase mb-1.5">Type</label>
                                        <div className="flex gap-2">
                                            {Object.keys(TYPES).map(key => (
                                                <button
                                                    type="button"
                                                    key={key}
                                                    onClick={() => setFormData({...formData, type: key})}
                                                    className={`flex-1 py-2 px-3 rounded-lg text-xs font-medium flex items-center justify-center gap-2 border shadow-sm transition-all ${formData.type === key ? 'bg-blue-50/80 border-blue-200 text-blue-700' : 'bg-white/50 border-white/60 text-slate-600 hover:bg-white/80'}`}
                                                >
                                                    <div className={`w-2 h-2 rounded-full ${TYPES[key].color}`}></div>
                                                    {TYPES[key].label}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-xs font-bold text-slate-500 uppercase mb-1.5">Priority</label>
                                        <select
                                            value={formData.priority}
                                            onChange={(e) => setFormData({...formData, priority: e.target.value})}
                                            className="w-full bg-white/50 border border-white/60 text-slate-700 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 shadow-sm"
                                        >
                                            <option value="low">Low</option>
                                            <option value="medium">Medium</option>
                                            <option value="high">High</option>
                                        </select>
                                    </div>
                                     <div>
                                        <label className="block text-xs font-bold text-slate-500 uppercase mb-1.5">Assignee</label>
                                        <div className="flex items-center gap-2 p-2 bg-white/50 rounded-lg border border-white/60 shadow-sm">
                                            <div className="w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xs font-bold ring-1 ring-blue-200">
                                                {formData.assignee === 'Unassigned' ? '?' : formData.assignee}
                                            </div>
                                            <input 
                                                type="text" 
                                                value={formData.assignee}
                                                onChange={(e) => setFormData({...formData, assignee: e.target.value})}
                                                className="bg-transparent border-none text-sm text-slate-700 focus:ring-0 w-full"
                                                placeholder="Type initials..."
                                            />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="space-y-2">
                                <label className="text-xs font-bold text-slate-500 uppercase tracking-wider">Description</label>
                                <textarea
                                    rows="6"
                                    value={formData.description}
                                    onChange={(e) => setFormData({...formData, description: e.target.value})}
                                    className="block p-3 w-full text-sm text-slate-800 bg-white/50 rounded-xl border border-white/60 focus:ring-blue-500 focus:border-blue-500 shadow-inner backdrop-blur-sm"
                                    placeholder="Describe the issue in detail..."
                                ></textarea>
                            </div>

                            <div className="flex justify-end pt-4 border-t border-white/50 gap-3">
                                <button type="button" onClick={onClose} className="text-slate-600 hover:text-slate-800 text-sm font-medium px-4 py-2 rounded-lg hover:bg-white/50 transition-colors">Cancel</button>
                                <button type="submit" className="bg-blue-600/90 hover:bg-blue-600 text-white text-sm font-medium px-6 py-2 rounded-lg shadow-lg shadow-blue-500/30 hover:shadow-blue-500/40 transition-all flex items-center gap-2">
                                    <Icon name="save" size={16} />
                                    Save Issue
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        const App = () => {
            // --- STATE MANAGEMENT ---
            const [tickets, setTickets] = useState(() => {
                const saved = localStorage.getItem('jiraCloneTickets');
                return saved ? JSON.parse(saved) : INITIAL_DATA;
            });
            
            const [columns, setColumns] = useState(() => {
                const saved = localStorage.getItem('jiraCloneColumns');
                return saved ? JSON.parse(saved) : INITIAL_COLUMNS;
            });

            const [sprints, setSprints] = useState(() => {
                const saved = localStorage.getItem('jiraCloneSprints');
                return saved ? JSON.parse(saved) : INITIAL_SPRINTS;
            });

            const [teamMembers, setTeamMembers] = useState(['JD', 'AS', 'MK', 'RL']);
            const [pendingInvites, setPendingInvites] = useState([
                { email: 'alex.designer@company.com', role: 'Designer', status: 'Pending' }
            ]);

            const [userProfile, setUserProfile] = useState(() => {
                const saved = localStorage.getItem('jiraCloneProfile');
                return saved ? JSON.parse(saved) : {
                    name: 'John Doe',
                    role: 'Software Engineer',
                    email: 'john@glassboard.app',
                    initials: 'JD',
                    location: 'San Francisco, CA',
                    bio: 'Full-stack developer who loves clean code and glassmorphism UI design.'
                };
            });

            const [searchQuery, setSearchQuery] = useState('');
            const [filterPriority, setFilterPriority] = useState('all');
            const [filterAssignee, setFilterAssignee] = useState('all');

            const [isModalOpen, setIsModalOpen] = useState(false);
            const [isListOpen, setIsListOpen] = useState(false);
            const [isReportsOpen, setIsReportsOpen] = useState(false);
            const [isSprintsOpen, setIsSprintsOpen] = useState(false); // Sprints Modal
            const [isCreateSprintOpen, setIsCreateSprintOpen] = useState(false); // Create Sprint Modal
            const [isProfileOpen, setIsProfileOpen] = useState(false);
            const [isAddMemberOpen, setIsAddMemberOpen] = useState(false);
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);
            const [isAuthenticated, setIsAuthenticated] = useState(() => localStorage.getItem('jiraCloneAuth') === 'true');
            const [theme, setTheme] = useState(() => {
                const saved = localStorage.getItem('jiraCloneTheme');
                if (saved) return saved;
                return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            });
            
            const [selectedTicket, setSelectedTicket] = useState(null);
            const [draggedTicketId, setDraggedTicketId] = useState(null);
            const [isSidebarExpanded, setSidebarExpanded] = useState(true);

            // --- EFFECTS ---
            useEffect(() => {
                if(window.lucide) window.lucide.createIcons();
            }, [tickets, isModalOpen, isListOpen, isReportsOpen, isSprintsOpen, isProfileOpen, isAddMemberOpen, isSettingsOpen, isSidebarExpanded, teamMembers, columns]);

            useEffect(() => { localStorage.setItem('jiraCloneTickets', JSON.stringify(tickets)); }, [tickets]);
            useEffect(() => { localStorage.setItem('jiraCloneProfile', JSON.stringify(userProfile)); }, [userProfile]);
            useEffect(() => { localStorage.setItem('jiraCloneColumns', JSON.stringify(columns)); }, [columns]);
            useEffect(() => { localStorage.setItem('jiraCloneSprints', JSON.stringify(sprints)); }, [sprints]);
            useEffect(() => { localStorage.setItem('jiraCloneTheme', theme); }, [theme]);

            useEffect(() => {
                localStorage.setItem('jiraCloneAuth', isAuthenticated ? 'true' : '');
            }, [isAuthenticated]);

            useEffect(() => {
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }, [theme]);

            // --- HELPERS ---
            const uniqueAssignees = useMemo(() => {
                const assignees = new Set(tickets.map(t => t.assignee));
                return ['Unassigned', ...Array.from(assignees).filter(a => a !== 'Unassigned')];
            }, [tickets]);

            const filteredTickets = tickets.filter(t => {
                const matchesSearch = t.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    t.id.toLowerCase().includes(searchQuery.toLowerCase());
                const matchesPriority = filterPriority === 'all' || t.priority === filterPriority;
                const matchesAssignee = filterAssignee === 'all' || t.assignee === filterAssignee;
                return matchesSearch && matchesPriority && matchesAssignee;
            });

            // --- EVENT HANDLERS ---
            const onDragStart = (e, id) => {
                setDraggedTicketId(id);
                e.dataTransfer.effectAllowed = "move";
            };

            const onDragOver = (e) => { e.preventDefault(); };

            const onDrop = (e, status) => {
                e.preventDefault();
                if (!draggedTicketId) return;
                const updatedTickets = tickets.map(t => t.id === draggedTicketId ? { ...t, status } : t);
                setTickets(updatedTickets);
                setDraggedTicketId(null);
            };

            const handleCreateClick = () => { setSelectedTicket(null); setIsModalOpen(true); };
            const handleTicketClick = (ticket) => { setSelectedTicket(ticket); setIsModalOpen(true); };

            const handleSaveTicket = (ticketData) => {
                const exists = tickets.some(t => t.id === ticketData.id);
                if (exists) {
                    setTickets(tickets.map(t => t.id === ticketData.id ? ticketData : t));
                } else {
                    const { isDraft, ...cleanTicket } = ticketData;
                    setTickets([...tickets, cleanTicket]);
                }
                setIsModalOpen(false);
            };

            const handleDeleteTicket = (id) => {
                setTickets(tickets.filter(t => t.id !== id));
                setIsModalOpen(false);
            };

            const handleUpdateProfile = (newProfile) => {
                setUserProfile(newProfile);
                setIsProfileOpen(false);
            };

            const handleAddMember = (newMember) => {
                let initials = '??';
                if (newMember.name) {
                    initials = newMember.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
                } else {
                    initials = newMember.email.substring(0, 2).toUpperCase();
                }
                setPendingInvites([...pendingInvites, { ...newMember, status: 'Sent just now' }]);
                setTeamMembers([...teamMembers, initials]); 
            };

            const handleUpdateColumns = (newColumns) => {
                setColumns(newColumns);
                setIsSettingsOpen(false);
            };

            const handleRemoveMember = (index) => {
                const newMembers = [...teamMembers];
                newMembers.splice(index, 1);
                setTeamMembers(newMembers);
            };

            const handleRevokeInvite = (index) => {
                const newInvites = [...pendingInvites];
                newInvites.splice(index, 1);
                setPendingInvites(newInvites);
            };

            const handleSaveSprint = (newSprint) => {
                const id = Math.max(0, ...sprints.map(s => s.id)) + 1;
                setSprints([...sprints, { ...newSprint, id }]);
            };

            const handleUpdateSprintStatus = (id, newStatus) => {
                setSprints(sprints.map(s => s.id === id ? { ...s, status: newStatus, progress: newStatus === 'completed' ? 100 : s.progress } : s));
            };

            // Authentication flows (mocked)
            const handleAuthSignIn = ({ email }) => {
                // if we have a saved profile, use it; otherwise create a minimal one
                const saved = localStorage.getItem('jiraCloneProfile');
                let profile = saved ? JSON.parse(saved) : null;
                if (!profile || profile.email !== email) {
                    profile = {
                        name: email.split('@')[0],
                        role: 'Member',
                        email,
                        initials: email.substring(0,2).toUpperCase(),
                        location: '',
                        bio: ''
                    };
                }
                setUserProfile(profile);
                saveAuth(profile);
                setIsAuthenticated(true);
            };

            const handleAuthSignUp = ({ name, email }) => {
                const profile = {
                    name: name || email.split('@')[0],
                    role: 'Member',
                    email,
                    initials: (name || email.split('@')[0]).split(' ').map(n => n[0]).join('').substring(0,2).toUpperCase(),
                    location: '',
                    bio: ''
                };
                setUserProfile(profile);
                saveAuth(profile);
                setIsAuthenticated(true);
            };

            const handleAuthGoogle = (email) => {
                const profile = {
                    name: email.split('@')[0],
                    role: 'Member',
                    email,
                    initials: email.substring(0,2).toUpperCase(),
                    location: '',
                    bio: ''
                };
                setUserProfile(profile);
                saveAuth(profile);
                setIsAuthenticated(true);
            };

            const handleSignOut = () => {
                setIsAuthenticated(false);
                clearAuth();
            };

            return (
                <div className="flex min-h-screen">
                    <Sidebar 
                        isExpanded={isSidebarExpanded} 
                        toggleSidebar={() => setSidebarExpanded(!isSidebarExpanded)}
                        onOpenBacklog={() => setIsListOpen(true)} 
                        onOpenReports={() => setIsReportsOpen(true)}
                        onOpenSprints={() => setIsSprintsOpen(true)}
                        onOpenProfile={() => setIsProfileOpen(true)}
                        userProfile={userProfile}
                    />
                    
                    <div className={`flex-1 flex flex-col min-w-0 h-screen overflow-hidden transition-all duration-300 ease-in-out ${isSidebarExpanded ? 'ml-64' : 'ml-16'}`}>
                        <header className="glass-header h-16 flex items-center justify-between px-6 sticky top-0 z-20">
                            <div className="flex items-center text-white/80 text-sm breadcrumbs font-medium">
                                <span className="hover:text-white cursor-pointer transition-colors">Projects</span>
                                <span className="mx-2 text-white/40">/</span>
                                <span className="hover:text-white cursor-pointer transition-colors">GlassBoard</span>
                                <span className="mx-2 text-white/40">/</span>
                                <span className="font-bold text-white shadow-sm">Kanban Board</span>
                            </div>

                            <div className="flex items-center gap-4">
                                <div className="hidden md:flex items-center gap-2">
                                    <select 
                                        value={filterPriority}
                                        onChange={(e) => setFilterPriority(e.target.value)}
                                        className="bg-white/10 border border-white/20 rounded-lg text-xs text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/30 focus:bg-white/20 transition-all py-1.5 px-2 backdrop-blur-sm cursor-pointer"
                                    >
                                        <option value="all" className="text-slate-800">All Priorities</option>
                                        <option value="high" className="text-slate-800">High</option>
                                        <option value="medium" className="text-slate-800">Medium</option>
                                        <option value="low" className="text-slate-800">Low</option>
                                    </select>

                                    <select 
                                        value={filterAssignee}
                                        onChange={(e) => setFilterAssignee(e.target.value)}
                                        className="bg-white/10 border border-white/20 rounded-lg text-xs text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/30 focus:bg-white/20 transition-all py-1.5 px-2 backdrop-blur-sm cursor-pointer"
                                    >
                                        <option value="all" className="text-slate-800">All Assignees</option>
                                        {uniqueAssignees.map(a => (
                                            <option key={a} value={a} className="text-slate-800">{a}</option>
                                        ))}
                                    </select>
                                    
                                    {(filterPriority !== 'all' || filterAssignee !== 'all') && (
                                        <button 
                                            onClick={() => { setFilterPriority('all'); setFilterAssignee('all'); }}
                                            className="p-1.5 hover:bg-white/10 rounded text-white/60 hover:text-white transition-colors"
                                            title="Clear Filters"
                                        >
                                            <Icon name="x" size={14} />
                                        </button>
                                    )}
                                </div>
                                <div className="h-6 w-px bg-white/20 mx-1 hidden md:block"></div>

                                <div className="relative hidden md:block group">
                                    <Icon name="search" className="absolute left-3 top-2.5 text-white/60 group-hover:text-white transition-colors" size={18} />
                                    <input 
                                        type="text" 
                                        placeholder="Search board" 
                                        className="pl-10 pr-4 py-2 bg-white/10 border border-white/20 rounded-lg text-sm text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/30 focus:bg-white/20 transition-all w-64 backdrop-blur-sm"
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                    />
                                </div>
                                
                                <button className="p-2 rounded-full text-white/80 hover:text-white hover:bg-white/10 transition-all">
                                    <Icon name="bell" size={20} />
                                </button>
                                <button 
                                    onClick={() => setIsSettingsOpen(true)}
                                    className="p-2 rounded-full text-white/80 hover:text-white hover:bg-white/10 transition-all"
                                >
                                    <Icon name="settings" size={20} />
                                </button>
                            </div>
                        </header>

                        <main className="flex-1 p-6 overflow-x-auto overflow-y-auto">
                            
                            <div className="flex justify-between items-center mb-8">
                                <h1 className="text-3xl font-bold text-white drop-shadow-md tracking-tight">Kanban Board</h1>
                                <div className="flex gap-3">
                                    <div className="hidden md:flex items-center -space-x-2 mr-4">
                                        {teamMembers.map((initial, i) => (
                                            <div key={i} className="w-9 h-9 rounded-full bg-gradient-to-br from-white/80 to-white/40 backdrop-blur-md border-2 border-white/20 flex items-center justify-center text-xs font-bold text-slate-700 shadow-md" title="Team Member">
                                                {initial}
                                            </div>
                                        ))}
                                        <div 
                                            onClick={() => setIsAddMemberOpen(true)}
                                            className="w-9 h-9 rounded-full bg-white/10 border-2 border-dashed border-white/40 flex items-center justify-center text-white hover:bg-white/20 cursor-pointer backdrop-blur-sm transition-colors"
                                            title="Add Team Member"
                                        >
                                            +
                                        </div>
                                    </div>
                                    <button 
                                        onClick={handleCreateClick}
                                        className="bg-white/90 hover:bg-white text-blue-600 px-5 py-2 rounded-lg text-sm font-bold shadow-lg shadow-black/5 flex items-center gap-2 transition-all transform hover:scale-105"
                                    >
                                        <Icon name="plus" size={18} />
                                        Create Issue
                                    </button>
                                </div>
                            </div>

                            <div className="flex h-[calc(100vh-180px)] gap-6 overflow-x-auto pb-4 items-start">
                                {columns.map(column => {
                                    const columnTickets = filteredTickets.filter(t => t.status === column.id);
                                    
                                    return (
                                        <div 
                                            key={column.id} 
                                            className="glass-column flex-shrink-0 w-80 flex flex-col max-h-full transition-colors"
                                            onDragOver={onDragOver}
                                            onDrop={(e) => onDrop(e, column.id)}
                                        >
                                            <div className="p-4 flex items-center justify-between sticky top-0 z-10 border-b border-white/20">
                                                <div className="flex items-center gap-2">
                                                    <h3 className="text-xs font-bold text-white/90 uppercase tracking-wider drop-shadow-sm">{column.title}</h3>
                                                    <span className="bg-white/20 text-white text-[10px] px-2 py-0.5 rounded-full font-bold shadow-inner backdrop-blur-md">
                                                        {columnTickets.length}
                                                    </span>
                                                </div>
                                                <Icon name="more-horizontal" size={16} className="text-white/60 cursor-pointer hover:text-white transition-colors" />
                                            </div>

                                            <div className="p-3 flex-1 overflow-y-auto custom-scrollbar space-y-3 min-h-[150px]">
                                                {columnTickets.map(ticket => (
                                                    <TicketCard 
                                                        key={ticket.id} 
                                                        ticket={ticket} 
                                                        onDragStart={onDragStart}
                                                        onClick={handleTicketClick}
                                                    />
                                                ))}
                                                {columnTickets.length === 0 && (
                                                    <div className="h-32 flex flex-col items-center justify-center text-white/40 border-2 border-dashed border-white/20 rounded-xl m-1">
                                                        <p className="text-xs font-medium">Drop issues here</p>
                                                    </div>
                                                )}
                                            </div>
                                            
                                            <div 
                                                onClick={() => {
                                                    setSelectedTicket({
                                                        id: `PROJ-${Math.floor(Math.random() * 10000)}`,
                                                        status: column.id,
                                                        title: '', description: '', priority: 'medium', type: 'task', assignee: 'Unassigned',
                                                        isDraft: true 
                                                    });
                                                    setIsModalOpen(true);
                                                }}
                                                className="p-3 m-2 rounded-lg hover:bg-white/20 text-white/70 hover:text-white text-sm font-medium cursor-pointer flex items-center gap-2 transition-all mt-auto border border-transparent hover:border-white/20"
                                            >
                                                <Icon name="plus" size={16} />
                                                Create issue
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </main>
                    </div>

                    {/* Modals */}
                    <TicketModal 
                        isOpen={isModalOpen} 
                        onClose={() => setIsModalOpen(false)}
                        ticket={selectedTicket}
                        onSave={handleSaveTicket}
                        onDelete={handleDeleteTicket}
                        columns={columns}
                    />

                    <ListDashboard
                        isOpen={isListOpen}
                        onClose={() => setIsListOpen(false)}
                        tickets={tickets}
                        onTicketClick={(ticket) => {
                            setIsListOpen(false);
                            setSelectedTicket(ticket);
                            setIsModalOpen(true);
                        }}
                        columns={columns}
                    />

                    <ReportsDashboard 
                        isOpen={isReportsOpen}
                        onClose={() => setIsReportsOpen(false)}
                        tickets={tickets}
                        columns={columns}
                    />

                    <SprintsDashboard 
                        isOpen={isSprintsOpen}
                        onClose={() => setIsSprintsOpen(false)}
                        sprints={sprints}
                        onUpdateStatus={handleUpdateSprintStatus}
                        onCreateSprint={() => { setIsCreateSprintOpen(true); }}
                    />

                    <CreateSprintModal
                        isOpen={isCreateSprintOpen}
                        onClose={() => setIsCreateSprintOpen(false)}
                        onSave={handleSaveSprint}
                    />

                    <ProfileDashboard 
                        isOpen={isProfileOpen} 
                        onClose={() => setIsProfileOpen(false)}
                        profile={userProfile}
                        onSave={handleUpdateProfile}
                        onSignOut={handleSignOut}
                    />

                    <AddMemberModal 
                        isOpen={isAddMemberOpen}
                        onClose={() => setIsAddMemberOpen(false)}
                        onInvite={handleAddMember}
                        pendingInvites={pendingInvites}
                    />

                    <SettingsModal
                        isOpen={isSettingsOpen}
                        onClose={() => setIsSettingsOpen(false)}
                        columns={columns}
                        onUpdateColumns={handleUpdateColumns}
                        teamMembers={teamMembers}
                        onRemoveMember={handleRemoveMember}
                        pendingInvites={pendingInvites}
                        onRevokeInvite={handleRevokeInvite}
                        theme={theme}
                        onToggleTheme={() => setTheme(theme === 'dark' ? 'light' : 'dark')}
                    />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
